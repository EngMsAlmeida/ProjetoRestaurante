@page "/cardapio"
@using ProjetoRestaurante.Data
@using ProjetoRestaurante.Models
@inject AppDbContext DbContext
@using Microsoft.EntityFrameworkCore

<div class="container mt-4">
    <div class="card shadow-sm p-4">
        <h2 class="text-primary"><i class="bi bi-plus-circle"></i> Novo Item no CardÃ¡pio</h2>
        <hr />
        
        <div class="row g-3">
            <div class="col-md-6">
                <label class="form-label font-weight-bold">Nome do Lanche/Bebida</label>
                <input type="text" class="form-control form-control-lg" @bind="novoProduto.Nome" placeholder="Ex: X-Burguer Artesanal" />
            </div>
            <div class="col-md-3">
                <label class="form-label font-weight-bold">PreÃ§o (R$)</label>
                <input type="number" step="0.01" class="form-control form-control-lg" @bind="novoProduto.Preco" />
            </div>
            <div class="col-md-3 d-flex align-items-end">
                <button class="btn btn-success btn-lg w-100" @onclick="Salvar">
                    <i class="bi bi-save"></i> Gravar no Banco
                </button>
            </div>
        </div>
    </div>

    @if (produtosCadastrados != null && produtosCadastrados.Any())
    {
        <div class="mt-5">
            <h4>ðŸ“‹ Itens Cadastrados</h4>
            <table class="table table-hover mt-3">
                <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>PreÃ§o</th>
                        <th>AÃ§Ãµes</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var p in produtosCadastrados)
                    {
                        <tr>
                            <td>@p.Id</td>
                            <td>@p.Nome</td>
                            <td>@p.Preco.ToString("C")</td>
                        </tr>
                            <button class="btn btn-outline-danger btn-sm" @onclick="() => Excluir(p)">
                                Excluir
                            </button>
                    }
                </tbody>
            </table>
        </div>
    }
</div>

@code {
    private Produto novoProduto = new Produto();
    private List<Produto> produtosCadastrados = new();

    protected override void OnInitialized()
    {
        CarregarProdutos();
    }

    private void CarregarProdutos()
    {
        produtosCadastrados = DbContext.Produtos.OrderByDescending(p => p.Id).ToList();
    }

    private void Salvar()
    {
        if (!string.IsNullOrWhiteSpace(novoProduto.Nome) && novoProduto.Preco > 0)
        {
            DbContext.Produtos.Add(novoProduto);
            DbContext.SaveChanges();
            
            novoProduto = new Produto(); 
            CarregarProdutos(); 
        }
    }

    private void Excluir(Produto produtoParaRemover)
    {
        DbContext.Produtos.Remove(produtoParaRemover);
        DbContext.SaveChanges();
        CarregarProdutos();
    }
}